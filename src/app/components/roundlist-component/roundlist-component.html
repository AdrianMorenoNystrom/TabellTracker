<div class="header">
  <div class="title-group">
    <h2 class="meta">Totalt antal omgångar: {{ rounds.length }}</h2>
  </div>
  <div class="controls">
    <button
      mat-raised-button
      color="primary"
      class="add-round-button"
      (click)="openAddRoundDialog()"
      *ngIf="auth.isLoggedIn$() | async"
    >
      Lägg till omgång
    </button>

    <mat-form-field appearance="outline" class="sort-field">
      <mat-label>Sortera</mat-label>
      <mat-select (selectionChange)="onSortChange($event.value)">
        <mat-option value="recent">Senaste först</mat-option>
        <mat-option value="oldest">Äldst först</mat-option>
        <mat-option value="score_desc">Högst först</mat-option>
        <mat-option value="score_asc">Lägst först</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</div>

@if (rounds.length === 0) {
  <p class="empty">Inga omgångar än. Lägg till den första för att börja.</p>
} @else {
  <div class="rounds">
    @for (r of visibleRounds; track r.id) {
      <mat-card appearance="outlined" class="round-card">
        <mat-card-header>
          <mat-card-title>Omgång {{ r.roundNumber }}</mat-card-title>
          <mat-card-subtitle>Vecka {{ r.week }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div
            class="total"
            [ngClass]="{
              'low': r.totalScore >= 0 && r.totalScore <= 8,
              'medium': r.totalScore >= 9 && r.totalScore <= 10,
              'high': r.totalScore >= 11 && r.totalScore <= 13
            }"
          >
            <strong>{{ r.totalScore }}</strong>
          </div>
        </mat-card-content>
        <mat-card-actions>
          <button mat-stroked-button (click)="openDetails(r)">Detaljer</button>
          <button
            mat-icon-button
            color="warn"
            type="button"
            (click)="deleteRound(r.id)"
            *ngIf="auth.isLoggedIn$()"
            aria-label="Ta bort omgång"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </mat-card-actions>
      </mat-card>
    }
    <div style="text-align:center; margin-top:1rem" *ngIf="rounds.length > 5">
  <button mat-button [style]="'background-color:#00427A; color:#FFFF; padding:2rem;'" (click)="toggleShowAll()">
    {{ showAll ? 'Visa senaste 3' : 'Visa alla omgångar' }}
  </button>
</div>
  </div>
}